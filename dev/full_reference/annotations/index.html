<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Annotations · DiffPrivacyInference</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffPrivacyInference</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../getting_started/installation/">Installation</a></li><li><a class="tocitem" href="../../getting_started/quick_guide/">Quick Guide</a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../../tutorial/01_sensitivity_functions/">Sensitivity functions</a></li><li><a class="tocitem" href="../../tutorial/02_privacy_functions/">Privacy functions</a></li><li><a class="tocitem" href="../../tutorial/03_flux_dp/">Learning MNIST using <code>Flux.jl</code>, verified differentially private</a></li></ul></li><li><span class="tocitem">Full Reference</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../syntax/">Supported julia syntax</a></li><li class="is-active"><a class="tocitem" href>Annotations</a><ul class="internal"><li><a class="tocitem" href="#Function-kinds"><span>Function kinds</span></a></li><li><a class="tocitem" href="#Static-parameters"><span>Static parameters</span></a></li><li><a class="tocitem" href="#Black-boxes"><span>Black boxes</span></a></li><li><a class="tocitem" href="#Container-types"><span>Container types</span></a></li></ul></li><li><a class="tocitem" href="../builtins/">Builtins</a></li><li><a class="tocitem" href="../black_boxes/">Black Boxes</a></li><li><a class="tocitem" href="../demutation/">Demutation system</a></li><li><a class="tocitem" href="../scoping_rules/">Scoping rules</a></li><li><a class="tocitem" href="../measuring_distance/">Measuring Distance</a></li><li><a class="tocitem" href="../types/">Types</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li></ul></li><li><span class="tocitem">Development Notes</span><ul><li><a class="tocitem" href="../../development_notes/updating_haskell/">Managing the two repositories</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Full Reference</a></li><li class="is-active"><a href>Annotations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Annotations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DiffMu/DiffPrivacyInference.jl/blob/master/docs/src/full_reference/annotations.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="annotations"><a class="docs-heading-anchor" href="#annotations">Annotations</a><a id="annotations-1"></a><a class="docs-heading-anchor-permalink" href="#annotations" title="Permalink"></a></h1><p>Our typechecker can infer many things about your code, but is does need you to annotate certain parts to get rid of ambiguities. In general, the inferred bounds will always be better the more precisely you annotate function argument and return types. If you don&#39;t, you will most likely end up with a lot of unresolved <a href="../constraints/#constraints">constraints</a>. In addition, there are some custom annotations that you can use to inform the typechecker about your intentions towards certain parts of the code. Not using these will likely end in typechecking errors or catastrophically pessimistic inference results. Here&#39;s your options:</p><h2 id="Function-kinds"><a class="docs-heading-anchor" href="#Function-kinds">Function kinds</a><a id="Function-kinds-1"></a><a class="docs-heading-anchor-permalink" href="#Function-kinds" title="Permalink"></a></h2><h3 id="Priv()"><a class="docs-heading-anchor" href="#Priv()"><code>Priv()</code></a><a id="Priv()-1"></a><a class="docs-heading-anchor-permalink" href="#Priv()" title="Permalink"></a></h3><p>We distinguish between functions that provide differential privacy (so called <a href="../../tutorial/02_privacy_functions/#privacy-functions">privacy functions</a>), and ones that do not (so called <a href="../../tutorial/01_sensitivity_functions/#sensitivity-functions">sensitivity functions</a>). The typechecker cannot know whether you expect a function to be differentially private or not, so if you do you&#39;ll have to annotate your function definition using the <a href="../builtins/#DiffPrivacyInference.Priv-Tuple{}"><code>Priv()</code></a>/<a href="../builtins/#DiffPrivacyInference.Priv-Tuple{DataType}"><code>Priv(T)</code></a> type function. Its argument is the desired return type of the annotated function, no argument means any return type. For example to declare function <code>f</code> to be differentially private and returning something of type <code>Matrix</code>:</p><pre><code class="language-julia hljs">function f(eps, del, x::Matrix) :: Priv(Matrix)
   gaussian_mechanism(1, eps, del, x)
end</code></pre><p>The typechecker will proceed assuming <code>f</code> is differentially private and infer the privacy parameters. In the example case presented here, the <a href="../builtins/#DiffPrivacyInference.gaussian_mechanism-Tuple{Real, Real, Real, Any}"><code>gaussian_mechanism</code></a> is used to add noise and provide finite privacy parameters. If you don&#39;t use our privacy mechanisms or don&#39;t use them properly in a function that you annotated with <code>Priv()</code>, you will likely (and correctly) end up with infinite privacy parameters. If you do use one of the privacy mechanisms but do not annotate the surrounding function as private, you will get an error.</p><h3 id="PrivacyFunction"><a class="docs-heading-anchor" href="#PrivacyFunction"><code>PrivacyFunction</code></a><a id="PrivacyFunction-1"></a><a class="docs-heading-anchor-permalink" href="#PrivacyFunction" title="Permalink"></a></h3><p>If you want to write a higher-order function that takes a privacy function as an argument, you have to annotate that argument accordingly using <a href="../builtins/#DiffPrivacyInference.PrivacyFunction"><code>PrivacyFunction</code></a>. For example if we want to write a higher-order function <code>g</code> that we want to apply to our previously defined <code>f</code> it would need to look like this:</p><pre><code class="language-julia hljs">function g(f::PrivacyFunction, x::Matrix) :: Priv(Matrix)
   f(0.1, 0.1, x)
end</code></pre><h2 id="Static-parameters"><a class="docs-heading-anchor" href="#Static-parameters">Static parameters</a><a id="Static-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Static-parameters" title="Permalink"></a></h2><p>As you can read in the documentation of our <a href="../types/#types">types</a>, we allow two kinds of numeric function arguments – static and variable ones. Static arguments are usueful if you want the inferred sensitivity/privacy guarantee of some of your function&#39;s arguments to depend on the values of some other of the function arguments. A simple example with an argument annotated using the <a href="../builtins/#DiffPrivacyInference.Static-Tuple{}"><code>Static()</code></a>/<a href="../builtins/#DiffPrivacyInference.Static-Tuple{DataType}"><code>Static(T)</code></a> type function:</p><pre><code class="language-julia hljs">julia&gt; typecheck_hs_from_string(&quot;module L
          function f(x::Integer, y::Integer)
             x * y
          end
       end&quot;)
   
   ---------------------------------------------------------------------------
   Type:
   {
   |   (Integer @ ∞, Integer @ ∞) -&gt; Integer
   }
   
   ---------------------------------------------------------------------------



julia&gt; typecheck_hs_from_string(&quot;module L
          function f(x::Static(Integer), y::Integer)
             x * y
          end
       end&quot;)
   
   ---------------------------------------------------------------------------
   Type:
   {
   |   - Integer[x ©]@0
   |   
   |   - Integer@x
   |   --------------------------
   |    -&gt; Integer
   }</code></pre><p>In the first example, both arguments have infinite sensitivity, as they are both variable and we cannot bound the distance between <code>x*y</code> and <code>x*y&#39;</code> if <code>x</code> is variable. If we however annotate <code>x</code> to be static, the sensitivity in <code>y</code> can be expressed as the value of <code>x</code>. Note that the <code>x</code> argument has sensitivity <code>0</code>, as the type <code>Integer[x ©]</code> is a singleton type containing only one element, namely an integer number with value <code>x</code>. This means you can only input values here that are either actually runtime constants or annotated static themselves. Sensitivity and privacy guarantees for this parameter hence are not valid for all integers, but only for each individual fixed integer. So if the parameter is the data input of your function in whose privacy you are interested, you probably don&#39;t want to make it static.</p><h2 id="Black-boxes"><a class="docs-heading-anchor" href="#Black-boxes">Black boxes</a><a id="Black-boxes-1"></a><a class="docs-heading-anchor-permalink" href="#Black-boxes" title="Permalink"></a></h2><p>The typechecker cannot infer sensitivity/privacy guarantees for arbitrary code (see <a href="../syntax/#syntax">How to write checkable code</a>). We still support using some functions whose body we cannot check via the <a href="../black_boxes/#black-boxes">black box</a> construct. These functions must be defined inside the code that is typechecked, and you can tell the checker that it can&#39;t infer things about the body by using a <a href="../builtins/#DiffPrivacyInference.BlackBox-Tuple{}"><code>BlackBox()</code></a>/<a href="../builtins/#DiffPrivacyInference.BlackBox-Tuple{DataType}"><code>BlackBox(T)</code></a> annotation in the definition. Here&#39;s an example of a function calling a function from an imported module, which is not admissible in code that is supposed to be checked:</p><pre><code class="language-julia hljs">loss(X, y, m::DMModel) :: BlackBox() = Flux.crossentropy(m.model(X), y)</code></pre><h2 id="Container-types"><a class="docs-heading-anchor" href="#Container-types">Container types</a><a id="Container-types-1"></a><a class="docs-heading-anchor-permalink" href="#Container-types" title="Permalink"></a></h2><p><a href="../types/#types">Our types</a> for matrices, vectors and gradients contain more information than the julia-native types, namely the dimension, which metric is used to measure, and if there is a bound on the row norm. If you want to specify which metric you would like your guarantees to be given in, you can annotate by using the corresponding type functions instead of the native <code>Matrix{T}</code> etc. types:</p><ul><li><a href="../builtins/#DiffPrivacyInference.MetricMatrix-Tuple{Any, Float64}"><code>MetricMatrix</code></a><code>(T, L::Norm)</code></li><li><a href="../builtins/#DiffPrivacyInference.MetricVector-Tuple{Any, Float64}"><code>MetricVector</code></a><code>(T, L::Norm)</code></li><li><a href="../builtins/#DiffPrivacyInference.MetricGradient-Tuple{Any, Float64}"><code>MetricGradient</code></a><code>(T, L::Norm)</code></li></ul><p>where <code>L</code> is one of the norms <code>L1,L2,LInf</code> denoting the induced metric. See the documentation on <a href="../measuring_distance/#measuring-distance">container metrics</a> for more details about metrics.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../syntax/">« Supported julia syntax</a><a class="docs-footer-nextpage" href="../builtins/">Builtins »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Wednesday 11 May 2022 15:35">Wednesday 11 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
